# Screener - Trading Parameters Configuration
# Multi-Timeframe Momentum Reversal Trading System
#
# This file contains all trading strategy parameters, thresholds, and risk limits.
# Modify these values to adjust trading behavior.

# ===== Universe Configuration =====
universe:
  # Symbol filtering criteria
  min_price: 1.0                    # Minimum stock price (USD)
  max_price: 500.0                  # Maximum stock price (USD)
  min_avg_volume: 500000            # Minimum 20-day average volume
  min_market_cap: 100000000         # Minimum market cap (100M USD)
  max_spread_pct: 1.0               # Maximum bid-ask spread (%)

  # Exchanges and sectors
  excluded_exchanges:
    - PINK                          # Pink sheets (OTC)
    - OTCBB                         # OTC Bulletin Board

  # Symbol sources
  include_sp500: true               # Include S&P 500 components
  include_nasdaq100: true           # Include NASDAQ 100 components
  include_russell2000: false        # Include Russell 2000 (slower screening)

  # Universe size
  target_size: 1000                 # Target number of symbols to screen
  max_size: 2000                    # Maximum symbols (performance limit)

# ===== Timeframe Configuration =====
timeframes:
  # Primary timeframes for multi-TF analysis
  trigger: "5 mins"                 # T1: Entry trigger timeframe
  confirmation: "15 mins"           # T2: Confirmation timeframe
  regime: "1 hour"                  # T3: Regime/trend timeframe
  macro: "4 hours"                  # T4: Macro trend timeframe

  # Chart display timeframes (dashboard)
  chart_timeframes:
    - "5 mins"                      # 5-minute bars (NEW - per user request)
    - "15 mins"                     # 15-minute bars
    - "1 hour"                      # 1-hour bars
    - "4 hours"                     # 4-hour bars

  # Historical data lookback
  historical_days:
    "5 mins": 5                     # 5 days of 5-min bars
    "15 mins": 10                   # 10 days of 15-min bars
    "1 hour": 30                    # 30 days of 1-hour bars
    "4 hours": 90                   # 90 days of 4-hour bars

# ===== Indicator Parameters =====
indicators:
  bollinger_bands:
    period: 20                      # Moving average period
    std_dev: 2.0                    # Standard deviation multiplier

  stochastic_rsi:
    rsi_period: 14                  # Base RSI period
    stoch_period: 14                # Stochastic lookback period
    k_smooth: 3                     # %K smoothing
    d_smooth: 3                     # %D smoothing

  macd:
    fast_period: 12                 # Fast EMA period
    slow_period: 26                 # Slow EMA period
    signal_period: 9                # Signal line period

  rsi:
    period: 14                      # RSI period

  atr:
    period: 14                      # ATR period for volatility

  # Accumulation ratio (Component 3)
  accumulation:
    window: 50                      # Signal frequency window (bars)
    stoch_oversold: 20              # Stoch RSI oversold threshold
    rsi_oversold: 30                # RSI oversold threshold

# ===== SABR20 Scoring Thresholds =====
sabr20:
  # Component weights (must sum to 1.0)
  weights:
    setup_strength: 0.30            # Multi-TF confluence (0-30 pts)
    bottom_phase: 0.22              # Reversal quality (0-22 pts)
    accumulation_intensity: 0.18    # Stoch/RSI ratio (0-18 pts) **NEW**
    trend_momentum: 0.18            # Trend strength (0-18 pts)
    risk_reward: 0.10               # R:R profile (0-10 pts)
    volume_profile: 0.02            # Volume characteristics (0-2 pts)

  # Setup grading thresholds
  grades:
    A_plus:
      min_score: 75                 # A+ setup minimum score
      required_state: "BottomActive"
      min_rr: 2.0
    A:
      min_score: 65                 # A setup minimum score
      required_states:
        - "BottomActive"
        - "BottomSoon"
      min_rr: 1.5
    B:
      min_score: 55                 # B setup minimum score
      min_rr: 1.2
    C:
      min_score: 45                 # C setup minimum score
      min_rr: 1.0

  # Accumulation phase scoring
  accumulation_phases:
    early:                          # Best entry point
      min_ratio: 5.0
      max_rsi: 45
      points: 18
    mid:                            # High probability
      min_ratio: 3.0
      max_ratio: 5.0
      max_rsi: 50
      points: 14
    late:                           # Setup maturing
      min_ratio: 1.5
      max_ratio: 3.0
      min_rsi: 40
      max_rsi: 55
      points: 10
    breakout:                       # Confirmed but late
      min_ratio: 0.8
      max_ratio: 1.5
      min_rsi: 50
      points: 6

# ===== Screening Thresholds =====
screening:
  # Coarse filter (fast screening on 1h timeframe)
  coarse:
    stoch_oversold: 20              # Stoch RSI oversold level
    stoch_max: 40                   # Max Stoch RSI (not overbought)
    macd_rising: true               # MACD histogram must be rising
    price_vs_bb: "lower_half"       # Price in lower half of BB

  # Fine filter (multi-TF analysis)
  fine:
    min_preliminary_score: 40       # Minimum coarse score to proceed
    max_candidates: 200             # Max symbols for fine analysis

  # Watchlist generation
  watchlist:
    min_sabr20_score: 65            # Minimum score for actionable watchlist
    max_symbols: 20                 # Maximum watchlist size
    required_grades:
      - "A+"
      - "A"

# ===== Trade Execution Parameters (WITH SAFETY CONTROLS) =====
# CRITICAL SAFETY NOTICE:
# - These parameters calculate trade details for DISPLAY/PLANNING
# - Actual execution requires ENABLE_AUTO_TRADING=true in system_config.yaml
# - Default is SCREENER-ONLY mode (no live orders placed)
execution:
  # ===== SAFETY CONTROLS =====
  # PRIMARY SAFETY: Must be explicitly enabled (default: false)
  allow_execution: false            # ⚠️ NEVER enable without explicit intent

  # SECONDARY SAFETY: Paper trading enforcement (set in system_config.yaml)
  require_paper_trading_mode: true  # Force paper trading even if allow_execution=true

  # ===== Risk Management Parameters =====
  # Used for trade planning, scoring, and (if enabled) execution
  max_risk_per_trade_pct: 1.0       # Maximum 1% risk per trade
  max_total_risk_pct: 3.0           # Maximum 3% total portfolio risk
  max_concurrent_positions: 5       # Maximum open positions
  min_account_equity: 10000         # Minimum account size (USD)

  # R:R requirements (used in SABR20 Component 5 scoring)
  min_reward_risk: 1.5              # Minimum 1.5:1 R:R ratio
  preferred_reward_risk: 2.0        # Target 2:1 R:R ratio

  # ===== Stop Loss Calculation =====
  # Methods for calculating stop levels (for planning and scoring)
  stop_methods:
    - "atr_multiple"                # ATR-based stop
    - "swing_low"                   # Recent swing low
    - "bb_lower"                    # Lower Bollinger Band
  atr_multiplier: 1.5               # ATR multiplier for stops
  min_stop_distance_pct: 0.5        # Minimum 0.5% stop distance
  max_stop_distance_pct: 5.0        # Maximum 5% stop distance

  # ===== Profit Targets =====
  # Target levels for trade planning
  targets:
    tp1_r_multiple: 2.0             # First target at 2R
    tp1_exit_pct: 0.5               # Exit 50% at TP1
    tp2_method: "bb_upper"          # Second target at upper BB
    runner_pct: 0.25                # Keep 25% as runner

  # ===== Trailing Stops =====
  trailing:
    enable: true
    start_at_r: 1.0                 # Start trailing at 1R profit
    trail_distance_pct: 2.0         # Trail 2% below high

  # ===== Time-Based Exits =====
  time_stops:
    max_bars_in_trade: 50           # Exit after 50 bars if not at 1R
    close_before_market_close: true
    minutes_before_close: 15        # Exit 15 min before market close

  # ===== Position Sizing =====
  # Regime-based multipliers (applied to base position size)
  regime_multipliers:
    favorable: 1.0                  # Normal size in favorable regime
    neutral: 0.75                   # Reduce 25% in neutral regime
    hostile: 0.5                    # Reduce 50% in hostile regime
    extreme_vol: 0.5                # Reduce 50% in extreme volatility

# ===== Regime Analysis (Market Environment Assessment) =====
regime:
  # VIX thresholds (market environment classification)
  vix_levels:
    low: 15                         # VIX < 15 = Low volatility
    medium: 25                      # VIX 15-25 = Medium volatility
    high: 40                        # VIX 25-40 = High volatility
                                    # VIX > 40 = Extreme volatility

  # Trend consensus (multi-index agreement)
  trend:
    indices:                        # Indices to analyze
      - "SPY"                       # S&P 500
      - "QQQ"                       # NASDAQ 100
      - "IWM"                       # Russell 2000
      - "DIA"                       # Dow Jones
    min_favorable: 3                # Min 3/4 indices bullish for favorable regime

  # Market breadth thresholds
  breadth:
    min_advance_decline: 0.4        # A/D ratio threshold
    max_new_lows_pct: 30            # Max % new lows

# ===== Performance Targets =====
performance:
  # System performance
  max_screening_time_sec: 30        # Max time to screen 1000 symbols
  max_dashboard_update_ms: 500      # Max dashboard update time
  max_db_query_ms: 100              # Max database query time

  # Trading performance
  target_win_rate: 0.50             # 50% win rate target
  target_avg_r: 1.5                 # Average 1.5R per trade
  target_profit_factor: 1.5         # 1.5:1 profit factor
  max_drawdown_pct: 15.0            # 15% max drawdown limit

# ===== Schedule Configuration =====
schedule:
  # Pre-market jobs
  premarket:
    update_universe: "06:00"        # Update symbol lists
    update_historical: "06:15"      # Download overnight data
    comprehensive_screen: "07:00"   # Full screening run

  # Intraday jobs (during market hours)
  intraday:
    coarse_screen_interval: 1800    # 30 minutes (seconds)
    fine_screen_interval: 900       # 15 minutes
    position_update_interval: 5     # 5 seconds
    trailing_stop_interval: 60      # 1 minute
    regime_update_interval: 1800    # 30 minutes

  # Post-market jobs
  postmarket:
    save_data: "16:30"              # Save real-time data
    generate_reports: "16:45"       # Daily reports
    backup_database: "17:00"        # Database backup

# ===== Alert Configuration =====
alerts:
  # Alert triggers
  new_a_plus_setup: true            # Alert on new A+ setups
  regime_change: true               # Alert on regime changes
  position_target_hit: true         # Alert when TP hit
  position_stopped_out: true        # Alert on stop loss
  system_error: true                # Alert on critical errors

  # Alert methods
  email: false                      # Send email alerts
  slack: false                      # Send Slack alerts
  dashboard: true                   # Show on dashboard

# ===== Backtest Configuration =====
backtest:
  start_date: "2023-01-01"
  end_date: "2024-12-31"
  initial_capital: 100000
  commission_per_share: 0.005       # $0.005 per share
  slippage_pct: 0.1                 # 0.1% slippage
